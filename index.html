<body>
  <h1>Rank Your Top 5 Songs</h1>

  <!-- 1️⃣ Voting Form -->
  <form id="voteForm">
    <select id="first" name="first"></select>
    <select id="second" name="second"></select>
    <select id="third" name="third"></select>
    <select id="fourth" name="fourth"></select>
    <select id="fifth" name="fifth"></select>
    <button type="submit">Submit Vote</button>
  </form>

  <!-- 2️⃣ Scoreboard -->
  <h2>Current Scores</h2>
  <ul id="scoreboard"></ul>

  <!-- 3️⃣ JavaScript -->
  <script>
    const songs = [
      "Say It Ain't So - Weezer",
      "Halloween - AFI",
      "I Miss You - Blink 182",
      "Hunger Strike - Temple of the Dog",
      "Chop Suey! - System of a Down"
    ];

    const SCRIPT_URL = "YOUR_GOOGLE_SCRIPT_URL_HERE";

    // Populate dropdowns
    const selects = document.querySelectorAll("select");
    selects.forEach(select => {
      songs.forEach(song => {
        const option = document.createElement("option");
        option.value = song;
        option.textContent = song;
        select.appendChild(option);
      });
    });

    // Prevent duplicate selections
    function updateDropdowns() {
      const chosen = Array.from(selects).map(s => s.value);
      selects.forEach(select => {
        Array.from(select.options).forEach(opt => {
          opt.disabled = chosen.includes(opt.value) && select.value !== opt.value;
        });
      });
    }
    selects.forEach(select => select.addEventListener("change", updateDropdowns));

    // 3️⃣a Submit vote (POST)
    document.getElementById("voteForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const data = {
        first: document.getElementById("first").value,
        second: document.getElementById("second").value,
        third: document.getElementById("third").value,
        fourth: document.getElementById("fourth").value,
        fifth: document.getElementById("fifth").value
      };

      fetch(SCRIPT_URL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      })
      .then(() => {
        alert("Thanks for voting!");
        document.getElementById("voteForm").reset();
        updateScores(); // refresh scoreboard after vote
      })
      .catch(err => alert("Error submitting vote: " + err));
    });

    // 3️⃣b Fetch scores (GET)
    function updateScores() {
      fetch(SCRIPT_URL)
        .then(res => res.json())
        .then(data => {
          const scoreboard = document.getElementById("scoreboard");
          scoreboard.innerHTML = "";
          data.sort((a,b) => b.score - a.score).forEach(item => {
            const li = document.createElement("li");
            li.textContent = `${item.song}: ${item.score} points`;
            scoreboard.appendChild(li);
          });
        });
    }

    // Auto-refresh every 10 seconds
    setInterval(updateScores, 10000);
    updateScores();
  </script>
</body>
